(this["webpackJsonpapero-bar"]=this["webpackJsonpapero-bar"]||[]).push([[0],{44:function(e,t,n){},45:function(e,t,n){},70:function(e,t,n){"use strict";n.r(t);var c=n(0),s=n(1),a=n.n(s),r=n(34),o=n.n(r),l=(n(44),n(45),n(14)),i=n(2),u=Object(s.createContext)(),b=function(e){var t=Object(s.useState)([]),n=Object(i.a)(t,2),a=n[0],r=n[1],o=Object(s.useState)(""),b=Object(i.a)(o,2),j=b[0],d=b[1],O=Object(s.useState)(""),m=Object(i.a)(O,2),h=m[0],f=m[1],p=Object(s.useState)(null),x=Object(i.a)(p,2),g=x[0],v=x[1],S=Object(s.useState)([]),N=Object(i.a)(S,2),y=N[0],w=N[1],k=Object(s.useState)(null),C=Object(i.a)(k,2),L=C[0],I=C[1],P=Object(s.useState)(null),M=Object(i.a)(P,2),B=M[0],_=M[1];return Object(c.jsx)(u.Provider,{value:{bottles:a,setBottles:r,addBottles:function(e){r([].concat(Object(l.a)(a),[e]))},search:j,setSearch:d,selectedBottle:L,setSelectedBottle:I,message:B,setMessage:_,token:h,setToken:f,user:g,setUser:v,ingredients:y,setIngredients:w,addIngredients:function(e){w([].concat(Object(l.a)(y),[e]))}},children:e.children})},j=n(7),d=n(5),O=n(13),m=n(37),h=n(3),f=n.n(h),p=n(6),x=n(35),g=n.n(x).a.create({baseURL:"https://api-apero-bar.herokuapp.com/api"}),v=function(e){var t=e.headers,n=e.onSorting,a=Object(s.useState)(""),r=Object(i.a)(a,2),o=r[0],l=r[1],u=Object(s.useState)("asc"),b=Object(i.a)(u,2),j=b[0],d=b[1];return Object(c.jsx)("thead",{className:"bg-primary text-white",children:Object(c.jsx)("tr",{children:t.map((function(e){var t=e.name,s=e.field,a=e.sortable;return Object(c.jsxs)("th",{onClick:function(){return a?function(e){var t=e===o&&"asc"===j?"desc":"asc";l(e),d(t),n(e,t)}(s):null},children:[t,o&&o===s&&("asc"===j?Object(c.jsx)("i",{className:"fas fa-arrow-down"}):Object(c.jsx)("i",{class:"fas fa-arrow-up"}))]},t)}))})})},S=function(e){var t=e.onSearch,n=Object(s.useState)(""),a=Object(i.a)(n,2),r=a[0],o=a[1];return Object(c.jsx)("input",{type:"text",className:"form-control",style:{width:"240px"},placeholder:"Recherche",value:r,onChange:function(e){var n;n=e.target.value,o(n),t(n)}})},N=n(18),y=function(e){var t=e.total,n=void 0===t?0:t,a=e.itemsPerPage,r=void 0===a?3:a,o=e.currentPage,l=void 0===o?1:o,u=e.onPageChange,b=Object(s.useState)(0),j=Object(i.a)(b,2),d=j[0],O=j[1];Object(s.useEffect)((function(){n>0&&r>0&&O(Math.ceil(n/r))}),[n,r]);var m=Object(s.useMemo)((function(){for(var e=[],t=function(t){e.push(Object(c.jsx)(N.a.Item,{active:t===l,onClick:function(){return u(t)},children:t},t))},n=1;n<=d;n++)t(n);return e}),[d,l,u]);return 0===d?null:Object(c.jsxs)(N.a,{children:[Object(c.jsx)(N.a.Prev,{onClick:function(){return u(l-1)},disabled:1===l}),m,Object(c.jsx)(N.a.Next,{onClick:function(){return u(l+1)},disabled:l===d})]})},w=n.p+"static/media/loading.2187296e.gif",k=function(){return Object(c.jsx)("div",{className:"fp-container",children:Object(c.jsx)("img",{src:w,alt:"chargement",className:"fp-loader"})})},C=function(){var e=Object(s.useState)(!1),t=Object(i.a)(e,2),n=t[0],a=t[1];return[n?Object(c.jsx)(k,{}):null,function(){return a(!0)},function(){return a(!1)}]};function L(e){var t=Object(s.useContext)(u),n=t.user,a=t.bottles,r=t.setBottles,o=t.token,b=(t.setIngredients,C()),j=Object(i.a)(b,3),O=j[0],m=j[1],h=j[2],x=Object(s.useState)(0),N=Object(i.a)(x,2),w=N[0],k=N[1],L=Object(s.useState)(1),I=Object(i.a)(L,2),P=I[0],M=I[1],B=Object(s.useState)(""),_=Object(i.a)(B,2),E=_[0],F=_[1],R=Object(s.useState)({field:"",order:""}),T=Object(i.a)(R,2),U=T[0],D=T[1],H=Object(s.useState)([{name:"Nom",field:"name",sortable:!0},{name:"Type",field:"type",sortable:!0},{name:"Pays/R\xe9gion",field:"country",sortable:!0},{name:"Mill\xe9sime",field:"vintage",sortable:!0}]),J=Object(i.a)(H,2),A=J[0],z=J[1],V=Object(d.useHistory)();Object(s.useEffect)((function(){n&&!0===n.is_admin&&z([].concat(Object(l.a)(A),[{name:"actions",field:"actions"}]))}),[n]),Object(s.useEffect)((function(){(function(){var e=Object(p.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m(),e.prev=1,e.next=4,g.get("/bouteilles",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("bottletoken"),"}")}});case 4:t=e.sent,console.log("\ud83d\ude80 ~ file: BottlesList.js ~ line 42 ~ fetchData ~ fetchBottle",t),r(t.data),h(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(){return e.apply(this,arguments)}})()()}),[r]);var G=function(){var e=Object(p.a)(f.a.mark((function e(t,n){var c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(n),t.stopPropagation(),e.prev=2,e.next=5,g.delete("/bouteilles/".concat(n),{headers:{Authorization:"Bearer ".concat(o)}});case 5:c=e.sent,r(a.filter((function(e){return e.id!==n}))),console.log(c),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,n){return e.apply(this,arguments)}}(),q=Object(s.useMemo)((function(){var e=a;if(E&&(e=e.filter((function(e){return e.name.toLowerCase().includes(E.toLowerCase())||e.category.toLowerCase().includes(E.toLowerCase())||e.type.toLowerCase().includes(E.toLowerCase())||e.country.toLowerCase().includes(E.toLowerCase())}))),k(e.length),U.field){var t="asc"===U.order?1:-1;e=e.sort((function(e,n){return t*e[U.field].localeCompare(n[U.field])}))}return e.slice(50*(P-1),50*(P-1)+50)}),[a,P,E,U]);return Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{className:"row w-100",children:Object(c.jsx)("div",{className:"col mb-3 col-12 text-center",children:Object(c.jsxs)("div",{className:"row",children:[Object(c.jsx)("div",{className:"col-md-6",children:Object(c.jsx)(y,{total:w,itemsPerPage:50,currentPage:P,onPageChange:function(e){return M(e)}})}),Object(c.jsx)("div",{className:"col-md-6 d-flex flex-row-reverse",children:Object(c.jsx)(S,{onSearch:function(e){F(e),M(1)}})})]})})}),Object(c.jsxs)("table",{className:"table table-hover",children:[Object(c.jsx)(v,{headers:A,onSorting:function(e,t){return D({field:e,order:t})}}),Object(c.jsx)("tbody",{children:q&&q.map((function(e){return Object(c.jsxs)("tr",{onClick:function(){return t=e._id,void V.push("/bottles/".concat(t));var t},children:[Object(c.jsx)("td",{children:e.name}),Object(c.jsx)("td",{children:e.type}),Object(c.jsx)("td",{children:e.country}),Object(c.jsx)("td",{children:e.vintage}),n&&n.is_admin?Object(c.jsxs)("td",{className:"row",children:[Object(c.jsx)("button",{className:"btn btn-warning",onClick:function(t){return function(e,t){e.stopPropagation(),V.push("/bottles/".concat(t,"/update"))}(t,e._id)},children:"M\xe0j"}),Object(c.jsx)("button",{className:"btn btn-danger",onClick:function(t){return G(t,e._id)},children:"Sup"})]}):null]},e.id)}))})]}),O]})}function I(){var e=Object(s.useContext)(u),t=e.message,n=(e.user,Object(m.useHistory)()),a=(new Date).getTime()/1e3;return Object(s.useEffect)((function(){(!localStorage.getItem("bottletoken")||localStorage.getItem("bottletoken")&&Object(O.a)(localStorage.getItem("bottletoken")).exp<a)&&n.push("/login")}),[]),Object(c.jsxs)("div",{children:[t?Object(c.jsx)("div",{className:"alert alert-success",children:t}):null,Object(c.jsx)("h1",{children:"Ap\xe9ro-Bar de Cyril"}),Object(c.jsx)(L,{})]})}var P=function(){var e=Object(d.useHistory)(),t=Object(s.useContext)(u),n=t.message,a=t.setMessage,r=t.setToken,o=t.setUser,l=Object(s.useState)(""),b=Object(i.a)(l,2),m=b[0],h=b[1],x=Object(s.useState)(""),v=Object(i.a)(x,2),S=v[0],N=v[1],y=Object(s.useState)(""),w=Object(i.a)(y,2),k=(w[0],w[1]),C=Object(s.useState)(""),L=Object(i.a)(C,2),I=L[0],P=L[1],M=function(){var t=Object(p.a)(f.a.mark((function t(n){var c;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),t.prev=1,t.next=4,g.post("/auth",{username:m,password:S});case 4:c=t.sent,k(""),P(""),console.log(c),c.data.access_token&&(localStorage.setItem("bottletoken",c.data.access_token),r(c.data.access_token),o(Object(O.a)(c.data.access_token)),a("Vous \xeates connect\xe9"),e.push("/")),t.next=17;break;case 11:t.prev=11,t.t0=t.catch(1),console.log(JSON.stringify(t.t0.message.substr(-3))),P(t.t0.message.substr(-3)),console.log("code",I),console.log(t.t0);case 17:case"end":return t.stop()}}),t,null,[[1,11]])})));return function(e){return t.apply(this,arguments)}}();return Object(c.jsxs)("div",{children:[Object(c.jsx)("h1",{children:"Login"}),n?Object(c.jsx)("div",{className:"alert alert-success",children:n}):null,Object(c.jsxs)("form",{className:"mb-2",action:"submit",children:[Object(c.jsxs)("div",{className:"form-row",children:[Object(c.jsxs)("div",{className:"form-group col-8",children:[Object(c.jsx)("label",{htmlFor:"username",children:"Username"}),Object(c.jsx)("input",{value:m,onChange:function(e){return h(e.target.value)},id:"username",placeholder:"Username",type:"text",className:"form-control"})]}),Object(c.jsxs)("div",{className:"form-group col-8",children:[Object(c.jsx)("label",{htmlFor:"password",children:"Mot de passe"}),Object(c.jsx)("input",{value:S,onChange:function(e){return N(e.target.value)},id:"password",placeholder:"Mot de passe",type:"password",className:"form-control"})]})]}),Object(c.jsx)("button",{type:"submit",onClick:M,className:"btn btn-primary",children:"Submit"})]}),Object(c.jsx)(j.b,{to:"/register",children:Object(c.jsx)("button",{className:"btn btn-primary",children:"Go to Register"})}),Object(c.jsx)(j.b,{to:"/",children:Object(c.jsx)("button",{className:"btn btn-primary",children:"Home"})})]})},M=function(){var e=Object(d.useHistory)(),t=Object(s.useState)(""),n=Object(i.a)(t,2),a=n[0],r=n[1],o=Object(s.useState)(""),l=Object(i.a)(o,2),b=l[0],O=l[1],m=Object(s.useState)(""),h=Object(i.a)(m,2),x=h[0],v=h[1],S=Object(s.useState)(""),N=Object(i.a)(S,2),y=N[0],w=N[1],k=Object(s.useState)(""),C=Object(i.a)(k,2),L=C[0],I=C[1],P=Object(s.useContext)(u).setMessage,M=function(){var t=Object(p.a)(f.a.mark((function t(n){var c;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),t.prev=1,t.next=4,g.post("/users/register",{username:a,password:b});case 4:c=t.sent,v(""),I(""),P("Votre compte a bien \xe9t\xe9 cr\xe9\xe9. Vous pouvez vous connecter."),e.push("/login"),console.log(JSON.stringify(c)),t.next=18;break;case 12:t.prev=12,t.t0=t.catch(1),console.log(JSON.stringify(t.t0.message.substr(-3))),I(t.t0.message.substr(-3)),console.log("code",L),t.t0?v("Erreur d'identifiants ou de mot de passe"):v("");case 18:case"end":return t.stop()}}),t,null,[[1,12]])})));return function(e){return t.apply(this,arguments)}}();return Object(s.useEffect)((function(){w("500"===L?"L'identifiant n'est pas un username":""),w("409"===L?"L'adresse username existe d\xe9j\xe0":"")}),[L]),Object(c.jsxs)("div",{children:[Object(c.jsx)("h1",{children:"Register"}),Object(c.jsxs)("div",{className:"mb-2",children:[Object(c.jsxs)("div",{className:"form-row",children:[Object(c.jsxs)("div",{className:"form-group col-8",children:[Object(c.jsx)("label",{htmlFor:"username",children:"Username"}),Object(c.jsx)("input",{value:a,onChange:function(e){return r(e.target.value)},id:"username",placeholder:"Username",type:"text",className:"form-control"})]}),Object(c.jsxs)("div",{className:"form-group col-8",children:[Object(c.jsx)("label",{htmlFor:"password",children:"Mot de passe"}),Object(c.jsx)("input",{value:b,onChange:function(e){return O(e.target.value)},id:"password",placeholder:"Mot de passe",type:"password",className:"form-control"})]})]}),y?Object(c.jsx)("p",{className:"alert alert-danger",children:y}):"",x?Object(c.jsx)("p",{className:"alert alert-danger",children:x}):"",Object(c.jsx)("button",{type:"submit",onClick:M,className:"btn btn-primary",children:"Submit"})]}),Object(c.jsx)(j.b,{to:"/login",children:Object(c.jsx)("button",{className:"btn btn-primary",children:"Go to Login"})})]})};n(19),n(38);var B=function(){var e=Object(s.useContext)(u),t=e.message,n=e.setMessage,a=e.user,r=e.setUser,o=e.setToken;Object(s.useEffect)((function(){setTimeout((function(){n("")}),5e3)}),[t,n]),Object(s.useEffect)((function(){localStorage.getItem("bottletoken")?(r(Object(O.a)(localStorage.getItem("bottletoken"))),o(localStorage.getItem("bottletoken"))):r(null)}),[r,o]);return Object(c.jsxs)("div",{children:[a?Object(c.jsx)(j.b,{to:"/",children:Object(c.jsx)("button",{className:"btn btn-primary float-right",onClick:function(){r(null),localStorage.removeItem("bottletoken")},children:"D\xe9connecter"})}):Object(c.jsx)(j.b,{to:"/login",children:Object(c.jsx)("button",{className:"btn btn-primary float-right",children:"Login"})}),Object(c.jsx)(j.b,{to:"/",children:Object(c.jsx)("button",{className:"btn btn-primary",children:"Home"})}),a&&!0===a.is_admin?Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(j.b,{to:"/addbottle",children:Object(c.jsx)("button",{className:"btn btn-primary",children:"Add a Bottle"})}),Object(c.jsx)(j.b,{to:"/ingredients",children:Object(c.jsx)("button",{className:"btn btn-primary",children:"Ingredients"})})]}):null]})};var _=function(){return Object(c.jsx)(b,{children:Object(c.jsx)("div",{className:"container",children:Object(c.jsxs)(j.a,{children:[Object(c.jsx)(B,{}),Object(c.jsxs)(d.Switch,{children:[Object(c.jsx)(d.Route,{exact:!0,path:"/",component:I}),Object(c.jsx)(d.Route,{exact:!0,path:"/login",component:P}),Object(c.jsx)(d.Route,{exact:!0,path:"/register",component:M}),Object(c.jsx)(d.Route,{component:I})]})]})})})},E=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,71)).then((function(t){var n=t.getCLS,c=t.getFID,s=t.getFCP,a=t.getLCP,r=t.getTTFB;n(e),c(e),s(e),a(e),r(e)}))};o.a.render(Object(c.jsx)(a.a.StrictMode,{children:Object(c.jsx)(_,{})}),document.getElementById("root")),E()}},[[70,1,2]]]);
//# sourceMappingURL=main.3a7df1ad.chunk.js.map