(this["webpackJsonpapero-bar"]=this["webpackJsonpapero-bar"]||[]).push([[0],{44:function(e,t,c){},45:function(e,t,c){},70:function(e,t,c){"use strict";c.r(t);var n=c(0),a=c(1),s=c.n(a),r=c(35),o=c.n(r),l=(c(44),c(45),c(14)),i=c(2),j=Object(a.createContext)(),u=function(e){var t=Object(a.useState)([]),c=Object(i.a)(t,2),s=c[0],r=c[1],o=Object(a.useState)(""),u=Object(i.a)(o,2),b=u[0],d=u[1],O=Object(a.useState)(""),h=Object(i.a)(O,2),m=h[0],p=h[1],x=Object(a.useState)(null),f=Object(i.a)(x,2),g=f[0],v=f[1],y=Object(a.useState)([]),N=Object(i.a)(y,2),S=N[0],w=N[1],k=Object(a.useState)(null),C=Object(i.a)(k,2),I=C[0],F=C[1],B=Object(a.useState)(null),P=Object(i.a)(B,2),L=P[0],M=P[1];return Object(n.jsx)(j.Provider,{value:{bottles:s,setBottles:r,addBottles:function(e){r([].concat(Object(l.a)(s),[e]))},search:b,setSearch:d,selectedBottle:I,setSelectedBottle:F,message:L,setMessage:M,token:m,setToken:p,user:g,setUser:v,ingredients:S,setIngredients:w,addIngredients:function(e){w([].concat(Object(l.a)(S),[e]))}},children:e.children})},b=c(6),d=c(5),O=c(13),h=c(16),m=c(3),p=c.n(m),x=c(7),f=c(36),g=c.n(f).a.create({baseURL:"https://api-apero-bar.herokuapp.com/api"}),v=function(e){var t=e.headers,c=e.onSorting,s=Object(a.useState)(""),r=Object(i.a)(s,2),o=r[0],l=r[1],j=Object(a.useState)("asc"),u=Object(i.a)(j,2),b=u[0],d=u[1];return Object(n.jsx)("thead",{className:"bg-primary text-white",children:Object(n.jsx)("tr",{children:t.map((function(e){var t=e.name,a=e.field,s=e.sortable;return Object(n.jsxs)("th",{onClick:function(){return s?function(e){var t=e===o&&"asc"===b?"desc":"asc";l(e),d(t),c(e,t)}(a):null},children:[t,o&&o===a&&("asc"===b?Object(n.jsx)("i",{className:"fas fa-arrow-down"}):Object(n.jsx)("i",{class:"fas fa-arrow-up"}))]},t)}))})})},y=function(e){var t=e.onSearch,c=Object(a.useState)(""),s=Object(i.a)(c,2),r=s[0],o=s[1];return Object(n.jsx)("input",{type:"text",className:"form-control",style:{width:"240px"},placeholder:"Recherche",value:r,onChange:function(e){var c;c=e.target.value,o(c),t(c)}})},N=c(19),S=function(e){var t=e.total,c=void 0===t?0:t,s=e.itemsPerPage,r=void 0===s?3:s,o=e.currentPage,l=void 0===o?1:o,j=e.onPageChange,u=Object(a.useState)(0),b=Object(i.a)(u,2),d=b[0],O=b[1];Object(a.useEffect)((function(){c>0&&r>0&&O(Math.ceil(c/r))}),[c,r]);var h=Object(a.useMemo)((function(){for(var e=[],t=function(t){e.push(Object(n.jsx)(N.a.Item,{active:t===l,onClick:function(){return j(t)},children:t},t))},c=1;c<=d;c++)t(c);return e}),[d,l,j]);return 0===d?null:Object(n.jsxs)(N.a,{children:[Object(n.jsx)(N.a.Prev,{onClick:function(){return j(l-1)},disabled:1===l}),h,Object(n.jsx)(N.a.Next,{onClick:function(){return j(l+1)},disabled:l===d})]})},w=c.p+"static/media/loading.2187296e.gif",k=function(){return Object(n.jsx)("div",{className:"fp-container",children:Object(n.jsx)("img",{src:w,alt:"chargement",className:"fp-loader"})})},C=function(){var e=Object(a.useState)(!1),t=Object(i.a)(e,2),c=t[0],s=t[1];return[c?Object(n.jsx)(k,{}):null,function(){return s(!0)},function(){return s(!1)}]};function I(e){var t=Object(a.useContext)(j),c=t.user,s=t.bottles,r=t.setBottles,o=(t.token,t.setIngredients,C()),u=Object(i.a)(o,3),b=u[0],O=u[1],h=u[2],m=Object(a.useState)(0),f=Object(i.a)(m,2),N=f[0],w=f[1],k=Object(a.useState)(1),I=Object(i.a)(k,2),F=I[0],B=I[1],P=Object(a.useState)(""),L=Object(i.a)(P,2),M=L[0],E=L[1],R=Object(a.useState)({field:"",order:""}),T=Object(i.a)(R,2),D=T[0],H=T[1],A=Object(a.useState)([{name:"Nom",field:"name",sortable:!0},{name:"Type",field:"type",sortable:!0},{name:"Mill\xe9sime",field:"vintage",sortable:!0}]),U=Object(i.a)(A,2),z=U[0],_=U[1],V=Object(d.useHistory)();Object(a.useEffect)((function(){c&&"admin"==c.role&&_([].concat(Object(l.a)(z),[{name:"actions",field:"actions"}]))}),[c]),Object(a.useEffect)((function(){(function(){var e=Object(x.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O(),e.prev=1,e.next=4,g.get("/bouteilles",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("bottletoken"))}});case 4:t=e.sent,console.log("\ud83d\ude80 ~ file: BottlesList.js ~ line 42 ~ fetchData ~ fetchBottle",t),r(t.data),h(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(){return e.apply(this,arguments)}})()()}),[r]);var J=Object(a.useMemo)((function(){var e=s;if(M&&(e=e.filter((function(e){return e.name.toLowerCase().includes(M.toLowerCase())||e.category.toLowerCase().includes(M.toLowerCase())||e.type.toLowerCase().includes(M.toLowerCase())||e.country.toLowerCase().includes(M.toLowerCase())}))),w(e.length),D.field){var t="asc"===D.order?1:-1;e=e.sort((function(e,c){return t*e[D.field].localeCompare(c[D.field])}))}return e.slice(50*(F-1),50*(F-1)+50)}),[s,F,M,D]);return Object(n.jsxs)("div",{children:[Object(n.jsx)("div",{className:"row w-100",children:Object(n.jsx)("div",{className:"col mb-3 col-12 text-center",children:Object(n.jsxs)("div",{className:"row",children:[Object(n.jsx)("div",{className:"col-md-6",children:Object(n.jsx)(S,{total:N,itemsPerPage:50,currentPage:F,onPageChange:function(e){return B(e)}})}),Object(n.jsx)("div",{className:"col-md-6 d-flex flex-row-reverse",children:Object(n.jsx)(y,{onSearch:function(e){E(e),B(1)}})})]})})}),Object(n.jsxs)("table",{className:"table table-hover",children:[Object(n.jsx)(v,{headers:z,onSorting:function(e,t){return H({field:e,order:t})}}),Object(n.jsx)("tbody",{children:J&&J.map((function(e){return Object(n.jsxs)("tr",{onClick:function(){return t=e.id,void V.push("/bottles/".concat(t));var t},children:[Object(n.jsx)("td",{children:e.name}),Object(n.jsx)("td",{children:e.type}),Object(n.jsx)("td",{children:e.vintage})]},e.id)}))})]}),b]})}function F(){var e=Object(a.useContext)(j),t=e.message,c=(e.user,Object(h.useHistory)()),s=(new Date).getTime()/1e3;return Object(a.useEffect)((function(){(!localStorage.getItem("bottletoken")||localStorage.getItem("bottletoken")&&Object(O.a)(localStorage.getItem("bottletoken")).exp<s)&&c.push("/login")}),[]),Object(n.jsxs)("div",{children:[t?Object(n.jsx)("div",{className:"alert alert-success",children:t}):null,Object(n.jsx)("h1",{children:"Ap\xe9ro-Bar de Cyril & Christine"}),Object(n.jsx)(I,{})]})}var B=function(){var e=Object(d.useHistory)(),t=Object(a.useContext)(j),c=t.message,s=t.setMessage,r=t.setToken,o=t.setUser,l=Object(a.useState)(""),u=Object(i.a)(l,2),h=u[0],m=u[1],f=Object(a.useState)(""),v=Object(i.a)(f,2),y=v[0],N=v[1],S=Object(a.useState)(""),w=Object(i.a)(S,2),k=(w[0],w[1]),C=Object(a.useState)(""),I=Object(i.a)(C,2),F=I[0],B=I[1],P=function(){var t=Object(x.a)(p.a.mark((function t(c){var n;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c.preventDefault(),t.prev=1,t.next=4,g.post("/auth",{username:h,password:y});case 4:n=t.sent,k(""),B(""),n.data.access_token&&(localStorage.setItem("bottletoken",n.data.access_token),r(n.data.access_token),o(Object(O.a)(n.data.access_token)),s("Vous \xeates connect\xe9"),e.push("/")),t.next=16;break;case 10:t.prev=10,t.t0=t.catch(1),console.log(JSON.stringify(t.t0.message.substr(-3))),B(t.t0.message.substr(-3)),console.log("code",F),console.log(t.t0);case 16:case"end":return t.stop()}}),t,null,[[1,10]])})));return function(e){return t.apply(this,arguments)}}();return Object(n.jsxs)("div",{children:[Object(n.jsx)("h1",{children:"Login"}),c?Object(n.jsx)("div",{className:"alert alert-success",children:c}):null,Object(n.jsxs)("form",{className:"mb-2",action:"submit",children:[Object(n.jsxs)("div",{className:"form-row",children:[Object(n.jsxs)("div",{className:"form-group col-8",children:[Object(n.jsx)("label",{htmlFor:"username",children:"Username"}),Object(n.jsx)("input",{value:h,onChange:function(e){return m(e.target.value)},id:"username",placeholder:"Username",type:"text",className:"form-control"})]}),Object(n.jsxs)("div",{className:"form-group col-8",children:[Object(n.jsx)("label",{htmlFor:"password",children:"Mot de passe"}),Object(n.jsx)("input",{value:y,onChange:function(e){return N(e.target.value)},id:"password",placeholder:"Mot de passe",type:"password",className:"form-control"})]})]}),Object(n.jsx)("button",{type:"submit",onClick:P,className:"btn btn-primary",children:"Submit"})]}),Object(n.jsx)(b.b,{to:"/register",children:Object(n.jsx)("button",{className:"btn btn-primary",children:"Go to Register"})}),Object(n.jsx)(b.b,{to:"/",children:Object(n.jsx)("button",{className:"btn btn-primary",children:"Home"})})]})},P=function(){var e=Object(d.useHistory)(),t=Object(a.useState)(""),c=Object(i.a)(t,2),s=c[0],r=c[1],o=Object(a.useState)(""),l=Object(i.a)(o,2),u=l[0],O=l[1],h=Object(a.useState)(""),m=Object(i.a)(h,2),f=m[0],v=m[1],y=Object(a.useState)(""),N=Object(i.a)(y,2),S=N[0],w=N[1],k=Object(a.useState)(""),C=Object(i.a)(k,2),I=C[0],F=C[1],B=Object(a.useContext)(j).setMessage,P=function(){var t=Object(x.a)(p.a.mark((function t(c){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c.preventDefault(),t.prev=1,t.next=4,g.post("/users/register",{username:s,password:u});case 4:t.sent,v(""),F(""),B("Votre compte a bien \xe9t\xe9 cr\xe9\xe9. Vous pouvez vous connecter."),e.push("/login"),t.next=16;break;case 11:t.prev=11,t.t0=t.catch(1),F(t.t0.message.substr(-3)),console.log("code",I),t.t0?v("Erreur d'identifiants ou de mot de passe"):v("");case 16:case"end":return t.stop()}}),t,null,[[1,11]])})));return function(e){return t.apply(this,arguments)}}();return Object(a.useEffect)((function(){w("500"===I?"L'identifiant n'est pas un username":""),w("409"===I?"L'adresse username existe d\xe9j\xe0":"")}),[I]),Object(n.jsxs)("div",{children:[Object(n.jsx)("h1",{children:"Register"}),Object(n.jsxs)("div",{className:"mb-2",children:[Object(n.jsxs)("div",{className:"form-row",children:[Object(n.jsxs)("div",{className:"form-group col-8",children:[Object(n.jsx)("label",{htmlFor:"username",children:"Username"}),Object(n.jsx)("input",{value:s,onChange:function(e){return r(e.target.value)},id:"username",placeholder:"Username",type:"text",className:"form-control"})]}),Object(n.jsxs)("div",{className:"form-group col-8",children:[Object(n.jsx)("label",{htmlFor:"password",children:"Mot de passe"}),Object(n.jsx)("input",{value:u,onChange:function(e){return O(e.target.value)},id:"password",placeholder:"Mot de passe",type:"password",className:"form-control"})]})]}),S?Object(n.jsx)("p",{className:"alert alert-danger",children:S}):"",f?Object(n.jsx)("p",{className:"alert alert-danger",children:f}):"",Object(n.jsx)("button",{type:"submit",onClick:P,className:"btn btn-primary",children:"Submit"})]}),Object(n.jsx)(b.b,{to:"/login",children:Object(n.jsx)("button",{className:"btn btn-primary",children:"Go to Login"})})]})};function L(e){Object(a.useContext)(j).token;var t=Object(d.useParams)().id,c=Object(d.useHistory)(),s=Object(a.useState)(""),r=Object(i.a)(s,2),o=r[0],l=r[1],u=Object(a.useState)(""),b=Object(i.a)(u,2),O=b[0],h=b[1],m=Object(a.useState)(""),f=Object(i.a)(m,2),v=f[0],y=f[1],N=Object(a.useState)(""),S=Object(i.a)(N,2),w=S[0],k=S[1],C=Object(a.useState)(""),I=Object(i.a)(C,2),F=I[0],B=I[1],P=Object(a.useState)(""),L=Object(i.a)(P,2),M=L[0],E=L[1];Object(a.useEffect)((function(){(function(){var e=Object(x.a)(p.a.mark((function e(){var c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.get("/bouteilles/".concat(t),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("bottletoken"))}});case 2:c=e.sent,console.log(c.data.Bottle),l(c.data.name),h(c.data.image);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[t]);var R=function(){var e=Object(x.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n={categoryId:1,typeId:1,name:"nouveau",vintage:0,details:"string",image:"string",countryId:1,volume:"string",alcohol:0,quantity:1,display:!0,toBuy:!0},e.prev=2,e.next=5,g("/bouteilles",{method:"post",headers:{Authorization:"Bearer ".concat(localStorage.getItem("bottletoken")),"Content-Type":"application/json"},data:n});case 5:c.push("/"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}();return Object(n.jsxs)("div",{children:[Object(n.jsx)("h1",{className:"text-center",children:o}),Object(n.jsx)("p",{className:"text-center",children:"Mise \xe0 jour"}),Object(n.jsxs)("form",{action:"submit",children:[Object(n.jsxs)("div",{className:"form-group",children:[Object(n.jsx)("label",{htmlFor:"name",children:"Nom"}),Object(n.jsx)("input",{value:o,onChange:function(e){return l(e.target.value)},id:"name",type:"text",className:"form-control"})]}),Object(n.jsxs)("div",{className:"form-group",children:[Object(n.jsx)("label",{htmlFor:"imge",children:"Image"}),Object(n.jsx)("input",{value:O,onChange:function(e){return h(e.target.value)},id:"image",type:"text",className:"form-control"})]}),Object(n.jsxs)("div",{className:"form-group",children:[Object(n.jsx)("label",{htmlFor:"price",children:"Prix"}),Object(n.jsx)("input",{value:w,onChange:function(e){return k(e.target.value)},id:"price",type:"text",className:"form-control"})]}),Object(n.jsxs)("div",{className:"form-group",children:[Object(n.jsx)("label",{htmlFor:"base",children:"Base"}),Object(n.jsx)("input",{value:F,onChange:function(e){return B(e.target.value)},id:"base",type:"text",className:"form-control"})]}),Object(n.jsxs)("div",{className:"form-group",children:[Object(n.jsx)("label",{htmlFor:"status",children:"Statut"}),Object(n.jsx)("input",{value:M,onChange:function(e){return E(e.target.value)},id:"status",type:"text",className:"form-control"})]}),Object(n.jsxs)("div",{className:"form-group",children:[Object(n.jsx)("label",{htmlFor:"special",children:"Speciale ?"}),Object(n.jsx)("input",{value:v,onChange:function(e){return y(e.target.value)},id:"special",type:"text",className:"form-control"})]}),Object(n.jsx)("button",{type:"submit",onClick:R,className:"btn btn-primary",children:"Submit"}),Object(n.jsx)("button",{onClick:function(){return c.push("/bottles/".concat(t))},className:" btn btn-primary mx-5",children:"Cancel"})]})]})}function M(){var e=Object(d.useParams)().id,t=Object(a.useContext)(j).user,c=Object(a.useState)(""),s=Object(i.a)(c,2),r=s[0],o=s[1],l=Object(a.useState)([]),u=Object(i.a)(l,2),O=u[0],m=u[1],f=Object(h.useHistory)();Object(a.useEffect)((function(){try{(function(){var t=Object(x.a)(p.a.mark((function t(){var c;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.get("/bouteilles/".concat(e),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("bottletoken"))}});case 2:c=t.sent,console.log(c.data),o(c.data.name),m(c.data);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()}catch(t){console.log(t)}}),[e]);var v=function(){var e=Object(x.a)(p.a.mark((function e(t,c){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(c),t.stopPropagation(),e.prev=2,f.push("/"),e.next=6,g.delete("/bouteilles/".concat(c),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("bottletoken"))}});case 6:e.sent,window.location.reload(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,c){return e.apply(this,arguments)}}();return Object(n.jsxs)("div",{children:[Object(n.jsx)("h1",{className:"text-center",children:r}),Object(n.jsxs)("form",{action:"",children:[t&&"admin"==t.role?Object(n.jsxs)("div",{className:"d-flex justify-content-between",children:[Object(n.jsx)("button",{className:"btn btn-warning",onClick:function(t){return function(e,t){e.stopPropagation(),f.push("/bottles/".concat(t,"/update"))}(t,e)},children:"Mettre \xe0 jour"}),Object(n.jsx)(b.b,{to:"/",children:Object(n.jsx)("button",{className:"btn btn-danger",onClick:function(t){return v(t,e)},children:"Supprimer"})})]}):null,Object(n.jsxs)("div",{className:"form-group",children:[Object(n.jsxs)("p",{children:[Object(n.jsx)("label",{htmlFor:"image",children:"Image : "})," ",Object(n.jsx)("b",{children:O.image})]}),Object(n.jsxs)("p",{children:[Object(n.jsx)("label",{htmlFor:"categorie",children:"Cat\xe9gorie : "})," ",Object(n.jsx)("b",{children:O.category})]}),Object(n.jsxs)("p",{children:[Object(n.jsx)("label",{htmlFor:"type",children:"Type : "})," ",Object(n.jsx)("b",{children:O.type})]}),Object(n.jsxs)("p",{children:[Object(n.jsx)("label",{htmlFor:"country",children:"Pays/R\xe9gion : "})," ",Object(n.jsx)("b",{children:O.country})]}),Object(n.jsxs)("p",{children:[Object(n.jsx)("label",{htmlFor:"vintage",children:"Mill\xe9sime/Age : "})," ",Object(n.jsx)("b",{children:O.vintage})]}),Object(n.jsxs)("p",{children:[Object(n.jsx)("label",{htmlFor:"alcohol",children:"Degr\xe9 alcool : "})," ",Object(n.jsxs)("b",{children:[O.alcohol," \xb0"]})]}),Object(n.jsxs)("p",{children:[Object(n.jsx)("label",{htmlFor:"volume",children:"Volume : "})," ",Object(n.jsxs)("b",{children:[O.volume,"cl"]})]}),Object(n.jsxs)("p",{children:[Object(n.jsx)("label",{htmlFor:"detail",children:"D\xe9tails : "})," ",Object(n.jsx)("b",{children:O.details})]})]})]})]})}c(20),c(38);var E=function(){var e=Object(a.useContext)(j),t=e.message,c=e.setMessage,s=e.user,r=e.setUser,o=e.setToken;Object(h.useHistory)();Object(a.useEffect)((function(){setTimeout((function(){c("")}),5e3)}),[t,c]),Object(a.useEffect)((function(){localStorage.getItem("bottletoken")?(r(Object(O.a)(localStorage.getItem("bottletoken"))),o(localStorage.getItem("bottletoken"))):r(null)}),[r,o]);return Object(n.jsxs)("div",{children:[s?Object(n.jsx)(b.b,{to:"/",children:Object(n.jsx)("button",{className:"btn btn-primary float-right",onClick:function(){r(null),localStorage.removeItem("bottletoken"),window.location.reload()},children:"D\xe9connecter"})}):Object(n.jsx)(b.b,{to:"/login",children:Object(n.jsx)("button",{className:"btn btn-primary float-right",children:"Login"})}),Object(n.jsx)(b.b,{to:"/",children:Object(n.jsx)("button",{className:"btn btn-primary",children:"Home"})}),s&&!0===s.is_admin?Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(b.b,{to:"/addbottle",children:Object(n.jsx)("button",{className:"btn btn-primary",children:"Add a Bottle"})}),Object(n.jsx)(b.b,{to:"/ingredients",children:Object(n.jsx)("button",{className:"btn btn-primary",children:"Ingredients"})})]}):null]})};var R=function(){return Object(n.jsx)(u,{children:Object(n.jsx)("div",{className:"container",children:Object(n.jsxs)(b.a,{children:[Object(n.jsx)(E,{}),Object(n.jsxs)(d.Switch,{children:[Object(n.jsx)(d.Route,{exact:!0,path:"/",component:F}),Object(n.jsx)(d.Route,{exact:!0,path:"/login",component:B}),Object(n.jsx)(d.Route,{exact:!0,path:"/register",component:P}),Object(n.jsx)(d.Route,{exact:!0,path:"/bottles/:id",component:M}),Object(n.jsx)(d.Route,{exact:!0,path:"/bottles/:id/update",component:L}),Object(n.jsx)(d.Route,{component:F})]})]})})})},T=function(e){e&&e instanceof Function&&c.e(3).then(c.bind(null,71)).then((function(t){var c=t.getCLS,n=t.getFID,a=t.getFCP,s=t.getLCP,r=t.getTTFB;c(e),n(e),a(e),s(e),r(e)}))};o.a.render(Object(n.jsx)(s.a.StrictMode,{children:Object(n.jsx)(R,{})}),document.getElementById("root")),T()}},[[70,1,2]]]);
//# sourceMappingURL=main.8ab4220a.chunk.js.map