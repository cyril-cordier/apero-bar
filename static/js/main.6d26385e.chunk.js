(this["webpackJsonpapero-bar"]=this["webpackJsonpapero-bar"]||[]).push([[0],{43:function(e,t,n){},44:function(e,t,n){},69:function(e,t,n){"use strict";n.r(t);var c=n(0),s=n(1),a=n.n(s),r=n(34),o=n.n(r),l=(n(43),n(44),n(13)),i=n(2),u=Object(s.createContext)(),b=function(e){var t=Object(s.useState)([]),n=Object(i.a)(t,2),a=n[0],r=n[1],o=Object(s.useState)(""),b=Object(i.a)(o,2),j=b[0],d=b[1],O=Object(s.useState)(""),m=Object(i.a)(O,2),h=m[0],f=m[1],p=Object(s.useState)(null),x=Object(i.a)(p,2),g=x[0],v=x[1],N=Object(s.useState)([]),S=Object(i.a)(N,2),w=S[0],y=S[1],k=Object(s.useState)(null),C=Object(i.a)(k,2),L=C[0],P=C[1],M=Object(s.useState)(null),B=Object(i.a)(M,2),I=B[0],_=B[1];return Object(c.jsx)(u.Provider,{value:{bottles:a,setBottles:r,addBottles:function(e){r([].concat(Object(l.a)(a),[e]))},search:j,setSearch:d,selectedBottle:L,setSelectedBottle:P,message:I,setMessage:_,token:h,setToken:f,user:g,setUser:v,ingredients:w,setIngredients:y,addIngredients:function(e){y([].concat(Object(l.a)(w),[e]))}},children:e.children})},j=n(7),d=n(5),O=n(3),m=n.n(O),h=n(6),f=n(35),p=n.n(f).a.create({baseURL:"https://api-apero-bar.herokuapp.com/api"}),x=function(e){var t=e.headers,n=e.onSorting,a=Object(s.useState)(""),r=Object(i.a)(a,2),o=r[0],l=r[1],u=Object(s.useState)("asc"),b=Object(i.a)(u,2),j=b[0],d=b[1];return Object(c.jsx)("thead",{className:"bg-primary text-white",children:Object(c.jsx)("tr",{children:t.map((function(e){var t=e.name,s=e.field,a=e.sortable;return Object(c.jsxs)("th",{onClick:function(){return a?function(e){var t=e===o&&"asc"===j?"desc":"asc";l(e),d(t),n(e,t)}(s):null},children:[t,o&&o===s&&("asc"===j?Object(c.jsx)("i",{className:"fas fa-arrow-down"}):Object(c.jsx)("i",{class:"fas fa-arrow-up"}))]},t)}))})})},g=function(e){var t=e.onSearch,n=Object(s.useState)(""),a=Object(i.a)(n,2),r=a[0],o=a[1];return Object(c.jsx)("input",{type:"text",className:"form-control",style:{width:"240px"},placeholder:"Recherche",value:r,onChange:function(e){var n;n=e.target.value,o(n),t(n)}})},v=n(17),N=function(e){var t=e.total,n=void 0===t?0:t,a=e.itemsPerPage,r=void 0===a?3:a,o=e.currentPage,l=void 0===o?1:o,u=e.onPageChange,b=Object(s.useState)(0),j=Object(i.a)(b,2),d=j[0],O=j[1];Object(s.useEffect)((function(){n>0&&r>0&&O(Math.ceil(n/r))}),[n,r]);var m=Object(s.useMemo)((function(){for(var e=[],t=function(t){e.push(Object(c.jsx)(v.a.Item,{active:t===l,onClick:function(){return u(t)},children:t},t))},n=1;n<=d;n++)t(n);return e}),[d,l,u]);return 0===d?null:Object(c.jsxs)(v.a,{children:[Object(c.jsx)(v.a.Prev,{onClick:function(){return u(l-1)},disabled:1===l}),m,Object(c.jsx)(v.a.Next,{onClick:function(){return u(l+1)},disabled:l===d})]})},S=n.p+"static/media/loading.2187296e.gif",w=function(){return Object(c.jsx)("div",{className:"fp-container",children:Object(c.jsx)("img",{src:S,alt:"chargement",className:"fp-loader"})})},y=function(){var e=Object(s.useState)(!1),t=Object(i.a)(e,2),n=t[0],a=t[1];return[n?Object(c.jsx)(w,{}):null,function(){return a(!0)},function(){return a(!1)}]};function k(e){var t=Object(s.useContext)(u),n=t.user,a=t.bottles,r=t.setBottles,o=t.token,b=(t.setIngredients,y()),j=Object(i.a)(b,3),O=j[0],f=j[1],v=j[2],S=Object(s.useState)(0),w=Object(i.a)(S,2),k=w[0],C=w[1],L=Object(s.useState)(1),P=Object(i.a)(L,2),M=P[0],B=P[1],I=Object(s.useState)(""),_=Object(i.a)(I,2),F=_[0],E=_[1],U=Object(s.useState)({field:"",order:""}),T=Object(i.a)(U,2),D=T[0],J=T[1],R=Object(s.useState)([{name:"Nom",field:"name",sortable:!0},{name:"Type",field:"type",sortable:!0},{name:"Pays/R\xe9gion",field:"country",sortable:!0},{name:"Mill\xe9sime",field:"vintage",sortable:!0}]),A=Object(i.a)(R,2),z=A[0],V=A[1],G=Object(d.g)();Object(s.useEffect)((function(){n&&!0===n.is_admin&&V([].concat(Object(l.a)(z),[{name:"actions",field:"actions"}]))}),[n]),Object(s.useEffect)((function(){(function(){var e=Object(h.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(),e.prev=1,e.next=4,p.get("/bouteilles",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("bottletoken"),"}")}});case 4:t=e.sent,console.log("\ud83d\ude80 ~ file: BottlesList.js ~ line 42 ~ fetchData ~ fetchBottle",t),r(t.data),v(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(){return e.apply(this,arguments)}})()()}),[r]);var H=function(){var e=Object(h.a)(m.a.mark((function e(t,n){var c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(n),t.stopPropagation(),e.prev=2,e.next=5,p.delete("/bouteilles/".concat(n),{headers:{Authorization:"Bearer ".concat(o)}});case 5:c=e.sent,r(a.filter((function(e){return e.id!==n}))),console.log(c),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,n){return e.apply(this,arguments)}}(),q=Object(s.useMemo)((function(){var e=a;if(F&&(e=e.filter((function(e){return e.name.toLowerCase().includes(F.toLowerCase())||e.category.toLowerCase().includes(F.toLowerCase())||e.type.toLowerCase().includes(F.toLowerCase())||e.country.toLowerCase().includes(F.toLowerCase())}))),C(e.length),D.field){var t="asc"===D.order?1:-1;e=e.sort((function(e,n){return t*e[D.field].localeCompare(n[D.field])}))}return e.slice(50*(M-1),50*(M-1)+50)}),[a,M,F,D]);return Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{className:"row w-100",children:Object(c.jsx)("div",{className:"col mb-3 col-12 text-center",children:Object(c.jsxs)("div",{className:"row",children:[Object(c.jsx)("div",{className:"col-md-6",children:Object(c.jsx)(N,{total:k,itemsPerPage:50,currentPage:M,onPageChange:function(e){return B(e)}})}),Object(c.jsx)("div",{className:"col-md-6 d-flex flex-row-reverse",children:Object(c.jsx)(g,{onSearch:function(e){E(e),B(1)}})})]})})}),Object(c.jsxs)("table",{className:"table table-hover",children:[Object(c.jsx)(x,{headers:z,onSorting:function(e,t){return J({field:e,order:t})}}),Object(c.jsx)("tbody",{children:q&&q.map((function(e){return Object(c.jsxs)("tr",{onClick:function(){return t=e._id,void G.push("/bottles/".concat(t));var t},children:[Object(c.jsx)("td",{children:e.name}),Object(c.jsx)("td",{children:e.type}),Object(c.jsx)("td",{children:e.country}),Object(c.jsx)("td",{children:e.vintage}),n&&n.is_admin?Object(c.jsxs)("td",{className:"row",children:[Object(c.jsx)("button",{className:"btn btn-warning",onClick:function(t){return function(e,t){e.stopPropagation(),G.push("/bottles/".concat(t,"/update"))}(t,e._id)},children:"M\xe0j"}),Object(c.jsx)("button",{className:"btn btn-danger",onClick:function(t){return H(t,e._id)},children:"Sup"})]}):null]},e.id)}))})]}),O]})}function C(){var e=Object(s.useContext)(u),t=e.message;e.user;return Object(c.jsxs)("div",{children:[t?Object(c.jsx)("div",{className:"alert alert-success",children:t}):null,Object(c.jsx)("h1",{children:"Ap\xe9ro-Bar de Cyril"}),Object(c.jsx)(k,{})]})}var L=n(14),P=function(){var e=Object(d.g)(),t=Object(s.useContext)(u),n=t.message,a=t.setMessage,r=t.setToken,o=t.setUser,l=Object(s.useState)(""),b=Object(i.a)(l,2),O=b[0],f=b[1],x=Object(s.useState)(""),g=Object(i.a)(x,2),v=g[0],N=g[1],S=Object(s.useState)(""),w=Object(i.a)(S,2),y=(w[0],w[1]),k=Object(s.useState)(""),C=Object(i.a)(k,2),P=C[0],M=C[1],B=function(){var t=Object(h.a)(m.a.mark((function t(n){var c;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),t.prev=1,t.next=4,p.post("/auth",{username:O,password:v});case 4:c=t.sent,y(""),M(""),console.log(c),c.data.access_token&&(localStorage.setItem("bottletoken",c.data.access_token),r(c.data.access_token),o(Object(L.a)(c.data.access_token)),a("Vous \xeates connect\xe9"),e.push("/")),t.next=17;break;case 11:t.prev=11,t.t0=t.catch(1),console.log(JSON.stringify(t.t0.message.substr(-3))),M(t.t0.message.substr(-3)),console.log("code",P),console.log(t.t0);case 17:case"end":return t.stop()}}),t,null,[[1,11]])})));return function(e){return t.apply(this,arguments)}}();return Object(c.jsxs)("div",{children:[Object(c.jsx)("h1",{children:"Login"}),n?Object(c.jsx)("div",{className:"alert alert-success",children:n}):null,Object(c.jsxs)("form",{className:"mb-2",action:"submit",children:[Object(c.jsxs)("div",{className:"form-row",children:[Object(c.jsxs)("div",{className:"form-group col-8",children:[Object(c.jsx)("label",{htmlFor:"username",children:"Username"}),Object(c.jsx)("input",{value:O,onChange:function(e){return f(e.target.value)},id:"username",placeholder:"Username",type:"text",className:"form-control"})]}),Object(c.jsxs)("div",{className:"form-group col-8",children:[Object(c.jsx)("label",{htmlFor:"password",children:"Mot de passe"}),Object(c.jsx)("input",{value:v,onChange:function(e){return N(e.target.value)},id:"password",placeholder:"Mot de passe",type:"password",className:"form-control"})]})]}),Object(c.jsx)("button",{type:"submit",onClick:B,className:"btn btn-primary",children:"Submit"})]}),Object(c.jsx)(j.b,{to:"/register",children:Object(c.jsx)("button",{className:"btn btn-primary",children:"Go to Register"})}),Object(c.jsx)(j.b,{to:"/",children:Object(c.jsx)("button",{className:"btn btn-primary",children:"Home"})})]})},M=function(){var e=Object(d.g)(),t=Object(s.useState)(""),n=Object(i.a)(t,2),a=n[0],r=n[1],o=Object(s.useState)(""),l=Object(i.a)(o,2),b=l[0],O=l[1],f=Object(s.useState)(""),x=Object(i.a)(f,2),g=x[0],v=x[1],N=Object(s.useState)(""),S=Object(i.a)(N,2),w=S[0],y=S[1],k=Object(s.useState)(""),C=Object(i.a)(k,2),L=C[0],P=C[1],M=Object(s.useContext)(u).setMessage,B=function(){var t=Object(h.a)(m.a.mark((function t(n){var c;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),t.prev=1,t.next=4,p.post("/users/register",{username:a,password:b});case 4:c=t.sent,v(""),P(""),M("Votre compte a bien \xe9t\xe9 cr\xe9\xe9. Vous pouvez vous connecter."),e.push("/login"),console.log(JSON.stringify(c)),t.next=18;break;case 12:t.prev=12,t.t0=t.catch(1),console.log(JSON.stringify(t.t0.message.substr(-3))),P(t.t0.message.substr(-3)),console.log("code",L),t.t0?v("Erreur d'identifiants ou de mot de passe"):v("");case 18:case"end":return t.stop()}}),t,null,[[1,12]])})));return function(e){return t.apply(this,arguments)}}();return Object(s.useEffect)((function(){y("500"===L?"L'identifiant n'est pas un username":""),y("409"===L?"L'adresse username existe d\xe9j\xe0":"")}),[L]),Object(c.jsxs)("div",{children:[Object(c.jsx)("h1",{children:"Register"}),Object(c.jsxs)("div",{className:"mb-2",children:[Object(c.jsxs)("div",{className:"form-row",children:[Object(c.jsxs)("div",{className:"form-group col-8",children:[Object(c.jsx)("label",{htmlFor:"username",children:"Username"}),Object(c.jsx)("input",{value:a,onChange:function(e){return r(e.target.value)},id:"username",placeholder:"Username",type:"text",className:"form-control"})]}),Object(c.jsxs)("div",{className:"form-group col-8",children:[Object(c.jsx)("label",{htmlFor:"password",children:"Mot de passe"}),Object(c.jsx)("input",{value:b,onChange:function(e){return O(e.target.value)},id:"password",placeholder:"Mot de passe",type:"password",className:"form-control"})]})]}),w?Object(c.jsx)("p",{className:"alert alert-danger",children:w}):"",g?Object(c.jsx)("p",{className:"alert alert-danger",children:g}):"",Object(c.jsx)("button",{type:"submit",onClick:B,className:"btn btn-primary",children:"Submit"})]}),Object(c.jsx)(j.b,{to:"/login",children:Object(c.jsx)("button",{className:"btn btn-primary",children:"Go to Login"})})]})};n(18),n(37);var B=function(){var e=Object(s.useContext)(u),t=e.message,n=e.setMessage,a=e.user,r=e.setUser,o=e.setToken;Object(s.useEffect)((function(){setTimeout((function(){n("")}),5e3)}),[t,n]),Object(s.useEffect)((function(){localStorage.getItem("bottletoken")?(r(Object(L.a)(localStorage.getItem("bottletoken"))),o(localStorage.getItem("bottletoken"))):r(null)}),[r,o]);return Object(c.jsxs)("div",{children:[a?Object(c.jsx)(j.b,{to:"/",children:Object(c.jsx)("button",{className:"btn btn-primary float-right",onClick:function(){r(null),localStorage.removeItem("bottletoken")},children:"D\xe9connecter"})}):Object(c.jsx)(j.b,{to:"/login",children:Object(c.jsx)("button",{className:"btn btn-primary float-right",children:"Login"})}),Object(c.jsx)(j.b,{to:"/",children:Object(c.jsx)("button",{className:"btn btn-primary",children:"Home"})}),a&&!0===a.is_admin?Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(j.b,{to:"/addbottle",children:Object(c.jsx)("button",{className:"btn btn-primary",children:"Add a Bottle"})}),Object(c.jsx)(j.b,{to:"/ingredients",children:Object(c.jsx)("button",{className:"btn btn-primary",children:"Ingredients"})})]}):null]})};var I=function(){return Object(c.jsx)(b,{children:Object(c.jsx)("div",{className:"container",children:Object(c.jsxs)(j.a,{children:[Object(c.jsx)(B,{}),Object(c.jsxs)(d.d,{children:[Object(c.jsx)(d.b,{exact:!0,path:"/",component:C}),Object(c.jsx)(d.b,{exact:!0,path:"/login",component:P}),Object(c.jsx)(d.b,{exact:!0,path:"/register",component:M}),Object(c.jsx)(d.b,{component:C})]})]})})})},_=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,70)).then((function(t){var n=t.getCLS,c=t.getFID,s=t.getFCP,a=t.getLCP,r=t.getTTFB;n(e),c(e),s(e),a(e),r(e)}))};o.a.render(Object(c.jsx)(a.a.StrictMode,{children:Object(c.jsx)(I,{})}),document.getElementById("root")),_()}},[[69,1,2]]]);
//# sourceMappingURL=main.6d26385e.chunk.js.map